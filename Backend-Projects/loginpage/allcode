const express = require('express');
const path = require('path');
const cookieParser = require('cookie-parser');
const mongoose = require('./config/mongoose-connection');
const indexRoutes = require('./routes/index');
// const userRoutes = require('./routes/usersLogin');

const app = express();
const PORT = process.env.PORT || 3000;

app.use(express.json()); 
app.use(express.urlencoded({ extended: true }));
app.use(cookieParser());
app.use(express.static(path.join(__dirname, 'public')));

// Set EJS as the view engine
app.set('view engine', 'ejs');

// Routes
app.use('/', indexRoutes);
// app.use('/users', userRoutes);

// Server
app.listen(PORT, () => {
    console.log(`ðŸš€ Server running on http://localhost:${PORT}`);
});
this files is index.js
const express = require('express');
// const router = express.Router();

// router.get('/', (req, res) => {
//     res.render('index');
// });
const router = express.Router();
const { registerUser, loginUser } = require('../controllers/authControllers');

// Default route for testing
router.get('/', (req, res) => {
    res.render('index');
});

// Registration route
router.post('/register', registerUser);

// Login route
router.post('/login', loginUser);

// Error handling middleware (optional but useful)
router.use((err, req, res, next) => {
    console.error(err.stack);
    res.status(500).json({ message: 'Something went wrong!' });
});


module.exports = router;

this is files is mongoose-connections.js
const mongoose = require('mongoose');
require('dotenv').config(); // Use .env for sensitive data

const mongoURI = process.env.MONGODB_URL || 'mongodb://127.0.0.1:27017/loginpage';

mongoose.connect(mongoURI, {
    useNewUrlParser: true,
    useUnifiedTopology: true,
})
.then(() => console.log('âœ… MongoDB Connected Successfully'))
.catch((err) => console.error('âŒ MongoDB Connection Error:', err));

module.exports = mongoose.connection;
this is files is authControlers.js
const User = require('../models/user-model');
const bcrypt = require('bcrypt');
const { generateToken } = require('../utils/generateToken');

exports.registerUser = async (req, res) => {
    try {
        const { email, password, fullname } = req.body;

        if (!email || !password || !fullname) {
            return res.status(400).json({ message: 'All fields are required.' });
        }

        const existingUser = await User.findOne({ email });
        if (existingUser) {
            return res.status(409).json({ message: 'You already have an account. Please login.' });
        }

        const hashedPassword = await bcrypt.hash(password, 10);

        const newUser = await User.create({
            email,
            password: hashedPassword,
            fullname,
        });

        const token = generateToken(newUser._id);
        res.cookie('token', token, { httpOnly: true, secure: false }); // Use 'secure: true' in production

        res.status(201).json({ message: 'User created successfully', user: newUser });
    } catch (err) {
        console.error(err);
        res.status(500).json({ message: 'Server error', error: err.message });
    }
};

exports.loginUser = async (req, res) => {
    try {
        const { email, password } = req.body;

        if (!email || !password) {
            return res.status(400).json({ message: 'Email and password are required.' });
        }

        const user = await User.findOne({ email });
        if (!user) {
            return res.status(401).json({ message: 'Invalid credentials.' });
        }

        const isMatch = await bcrypt.compare(password, user.password);
        if (!isMatch) {
            return res.status(401).json({ message: 'Invalid credentials.' });
        }

        const token = generateToken(user._id);
        res.cookie('token', token, { httpOnly: true, secure: false });

        res.status(200).json({ message: 'Login successful', user: { email: user.email, fullname: user.fullname } });
    } catch (error) {
        console.error(error);
        res.status(500).json({ message: 'Server error', error: error.message });
    }
};
this is files is user-model
const mongoose = require('mongoose');

const userSchema = new mongoose.Schema({
    fullname: {
        type: String,
        required: true,
        minLength: 3,
        trim: true,
    },
    email: {
        type: String,
        required: true,
        unique: true,
        lowercase: true,
    },
    password: {
        type: String,
        required: true,
    },
    contact: {
        type: Number,
        required: false,
    },
    picture: {
        type: String,
        default: '',
    },
}, { timestamps: true });

module.exports = mongoose.model('User', userSchema);
 this is files is generaeToken.js
const jwt = require('jsonwebtoken');

exports.generateToken = (userId) => {
    return jwt.sign({ id: userId }, process.env.JWT_SECRET || 'default_secret', {
        expiresIn: '7d',
    });
};
 
this is files is index.ejs 
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
    
</head>
<body>
    


    <% if(error.length>0){ %>
        <div class="absolute top-5 left-1/2 -translate-x-1/2 -translate-y-1/2 p-3 rounded-md bg-red-500">
            <span class="inline-block mt-1 mb-1 text-white">
                <%= error %>
            </span>
        </div>
        <% } %>
            <div class="w-full h-screen flex px-20">
                <div class="w-1/2 flex items-center justify-center h-screen">
                    <div class="w-full px-32">
                        <h3 class="text-4xl">welcome to <span class="text-blue-400 font-semibold">Scatch</span></h3>
                        <h4 class="text-2xl mb-5">create your account</h4>
                        <form autocomplete="off" action="/users/register" method="post">
                            <input
                                class="bg-zinc-100 block w-full px-3 py-2 border-[1px] rounded-md mb-3 border-zinc-200"
                                type="text" placeholder="Full Name" name="fullname">
                            <input
                                class="bg-zinc-100 block w-full px-3 py-2 border-[1px] rounded-md mb-3 border-zinc-200"
                                type="email" placeholder="Email" name="email">
                            <input
                                class="bg-zinc-100 block w-full px-3 py-2 border-[1px] rounded-md mb-3 border-zinc-200"
                                type="password" placeholder="Password" name="password">
                            <input class="px-5 rounded-full py-3 mt-2 bg-blue-500 text-white" type="submit"
                                value="Create My Account">
                        </form>
                    </div>
                </div>
                <div class="w-1/2 flex items-center justify-center h-screen">
                    <div class="w-full px-32">
                        <h4 class="text-2xl capitalize mb-5">login your account</h4>
                        <form autocomplete="off" action="/users/login" method="post">
                            <input
                                class="block bg-zinc-100 w-full px-3 py-2 border-[1px] rounded-md mb-3 border-zinc-200"
                                type="email" placeholder="Email" name="email">
                            <input
                                class="block bg-zinc-100 w-full px-3 py-2 border-[1px] rounded-md mb-3 border-zinc-200"
                                type="password" placeholder="Password" name="password">
                            <input class="px-5 block rounded-full py-3 mt-2 bg-blue-500 text-white" type="submit"
                                value="Login">
                        </form>
                    </div>
                </div>
            </div>
            
    correct  this all code create a login page  reipoive and attrive side  

